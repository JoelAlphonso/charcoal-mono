/*! charcoal-admin 22-07-2015 */
(function(){var a=[].slice;!function(b,c){"use strict";var d;return d=function(){function a(a,c){null==c&&(c={}),this.$element=b(a),this.options=b.extend({},b.fn.bootstrapSwitch.defaults,{state:this.$element.is(":checked"),size:this.$element.data("size"),animate:this.$element.data("animate"),disabled:this.$element.is(":disabled"),readonly:this.$element.is("[readonly]"),indeterminate:this.$element.data("indeterminate"),inverse:this.$element.data("inverse"),radioAllOff:this.$element.data("radio-all-off"),onColor:this.$element.data("on-color"),offColor:this.$element.data("off-color"),onText:this.$element.data("on-text"),offText:this.$element.data("off-text"),labelText:this.$element.data("label-text"),handleWidth:this.$element.data("handle-width"),labelWidth:this.$element.data("label-width"),baseClass:this.$element.data("base-class"),wrapperClass:this.$element.data("wrapper-class")},c),this.$wrapper=b("<div>",{"class":function(a){return function(){var b;return b=[""+a.options.baseClass].concat(a._getClasses(a.options.wrapperClass)),b.push(a.options.state?""+a.options.baseClass+"-on":""+a.options.baseClass+"-off"),null!=a.options.size&&b.push(""+a.options.baseClass+"-"+a.options.size),a.options.disabled&&b.push(""+a.options.baseClass+"-disabled"),a.options.readonly&&b.push(""+a.options.baseClass+"-readonly"),a.options.indeterminate&&b.push(""+a.options.baseClass+"-indeterminate"),a.options.inverse&&b.push(""+a.options.baseClass+"-inverse"),a.$element.attr("id")&&b.push(""+a.options.baseClass+"-id-"+a.$element.attr("id")),b.join(" ")}}(this)()}),this.$container=b("<div>",{"class":""+this.options.baseClass+"-container"}),this.$on=b("<span>",{html:this.options.onText,"class":""+this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor}),this.$off=b("<span>",{html:this.options.offText,"class":""+this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor}),this.$label=b("<span>",{html:this.options.labelText,"class":""+this.options.baseClass+"-label"}),this.$element.on("init.bootstrapSwitch",function(b){return function(){return b.options.onInit.apply(a,arguments)}}(this)),this.$element.on("switchChange.bootstrapSwitch",function(b){return function(){return b.options.onSwitchChange.apply(a,arguments)}}(this)),this.$container=this.$element.wrap(this.$container).parent(),this.$wrapper=this.$container.wrap(this.$wrapper).parent(),this.$element.before(this.options.inverse?this.$off:this.$on).before(this.$label).before(this.options.inverse?this.$on:this.$off),this.options.indeterminate&&this.$element.prop("indeterminate",!0),this._init(),this._elementHandlers(),this._handleHandlers(),this._labelHandlers(),this._formHandler(),this._externalLabelHandler(),this.$element.trigger("init.bootstrapSwitch")}return a.prototype._constructor=a,a.prototype.state=function(a,b){return"undefined"==typeof a?this.options.state:this.options.disabled||this.options.readonly?this.$element:this.options.state&&!this.options.radioAllOff&&this.$element.is(":radio")?this.$element:(this.options.indeterminate&&this.indeterminate(!1),a=!!a,this.$element.prop("checked",a).trigger("change.bootstrapSwitch",b),this.$element)},a.prototype.toggleState=function(a){return this.options.disabled||this.options.readonly?this.$element:this.options.indeterminate?(this.indeterminate(!1),this.state(!0)):this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",a)},a.prototype.size=function(a){return"undefined"==typeof a?this.options.size:(null!=this.options.size&&this.$wrapper.removeClass(""+this.options.baseClass+"-"+this.options.size),a&&this.$wrapper.addClass(""+this.options.baseClass+"-"+a),this._width(),this._containerPosition(),this.options.size=a,this.$element)},a.prototype.animate=function(a){return"undefined"==typeof a?this.options.animate:(a=!!a,a===this.options.animate?this.$element:this.toggleAnimate())},a.prototype.toggleAnimate=function(){return this.options.animate=!this.options.animate,this.$wrapper.toggleClass(""+this.options.baseClass+"-animate"),this.$element},a.prototype.disabled=function(a){return"undefined"==typeof a?this.options.disabled:(a=!!a,a===this.options.disabled?this.$element:this.toggleDisabled())},a.prototype.toggleDisabled=function(){return this.options.disabled=!this.options.disabled,this.$element.prop("disabled",this.options.disabled),this.$wrapper.toggleClass(""+this.options.baseClass+"-disabled"),this.$element},a.prototype.readonly=function(a){return"undefined"==typeof a?this.options.readonly:(a=!!a,a===this.options.readonly?this.$element:this.toggleReadonly())},a.prototype.toggleReadonly=function(){return this.options.readonly=!this.options.readonly,this.$element.prop("readonly",this.options.readonly),this.$wrapper.toggleClass(""+this.options.baseClass+"-readonly"),this.$element},a.prototype.indeterminate=function(a){return"undefined"==typeof a?this.options.indeterminate:(a=!!a,a===this.options.indeterminate?this.$element:this.toggleIndeterminate())},a.prototype.toggleIndeterminate=function(){return this.options.indeterminate=!this.options.indeterminate,this.$element.prop("indeterminate",this.options.indeterminate),this.$wrapper.toggleClass(""+this.options.baseClass+"-indeterminate"),this._containerPosition(),this.$element},a.prototype.inverse=function(a){return"undefined"==typeof a?this.options.inverse:(a=!!a,a===this.options.inverse?this.$element:this.toggleInverse())},a.prototype.toggleInverse=function(){var a,b;return this.$wrapper.toggleClass(""+this.options.baseClass+"-inverse"),b=this.$on.clone(!0),a=this.$off.clone(!0),this.$on.replaceWith(a),this.$off.replaceWith(b),this.$on=a,this.$off=b,this.options.inverse=!this.options.inverse,this.$element},a.prototype.onColor=function(a){var b;return b=this.options.onColor,"undefined"==typeof a?b:(null!=b&&this.$on.removeClass(""+this.options.baseClass+"-"+b),this.$on.addClass(""+this.options.baseClass+"-"+a),this.options.onColor=a,this.$element)},a.prototype.offColor=function(a){var b;return b=this.options.offColor,"undefined"==typeof a?b:(null!=b&&this.$off.removeClass(""+this.options.baseClass+"-"+b),this.$off.addClass(""+this.options.baseClass+"-"+a),this.options.offColor=a,this.$element)},a.prototype.onText=function(a){return"undefined"==typeof a?this.options.onText:(this.$on.html(a),this._width(),this._containerPosition(),this.options.onText=a,this.$element)},a.prototype.offText=function(a){return"undefined"==typeof a?this.options.offText:(this.$off.html(a),this._width(),this._containerPosition(),this.options.offText=a,this.$element)},a.prototype.labelText=function(a){return"undefined"==typeof a?this.options.labelText:(this.$label.html(a),this._width(),this.options.labelText=a,this.$element)},a.prototype.handleWidth=function(a){return"undefined"==typeof a?this.options.handleWidth:(this.options.handleWidth=a,this._width(),this._containerPosition(),this.$element)},a.prototype.labelWidth=function(a){return"undefined"==typeof a?this.options.labelWidth:(this.options.labelWidth=a,this._width(),this._containerPosition(),this.$element)},a.prototype.baseClass=function(){return this.options.baseClass},a.prototype.wrapperClass=function(a){return"undefined"==typeof a?this.options.wrapperClass:(a||(a=b.fn.bootstrapSwitch.defaults.wrapperClass),this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" ")),this.$wrapper.addClass(this._getClasses(a).join(" ")),this.options.wrapperClass=a,this.$element)},a.prototype.radioAllOff=function(a){return"undefined"==typeof a?this.options.radioAllOff:(a=!!a,a===this.options.radioAllOff?this.$element:(this.options.radioAllOff=a,this.$element))},a.prototype.onInit=function(a){return"undefined"==typeof a?this.options.onInit:(a||(a=b.fn.bootstrapSwitch.defaults.onInit),this.options.onInit=a,this.$element)},a.prototype.onSwitchChange=function(a){return"undefined"==typeof a?this.options.onSwitchChange:(a||(a=b.fn.bootstrapSwitch.defaults.onSwitchChange),this.options.onSwitchChange=a,this.$element)},a.prototype.destroy=function(){var a;return a=this.$element.closest("form"),a.length&&a.off("reset.bootstrapSwitch").removeData("bootstrap-switch"),this.$container.children().not(this.$element).remove(),this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch"),this.$element},a.prototype._width=function(){var a,b;return a=this.$on.add(this.$off),a.add(this.$label).css("width",""),b="auto"===this.options.handleWidth?Math.max(this.$on.width(),this.$off.width()):this.options.handleWidth,a.width(b),this.$label.width(function(a){return function(c,d){return"auto"!==a.options.labelWidth?a.options.labelWidth:b>d?b:d}}(this)),this._handleWidth=this.$on.outerWidth(),this._labelWidth=this.$label.outerWidth(),this.$container.width(2*this._handleWidth+this._labelWidth),this.$wrapper.width(this._handleWidth+this._labelWidth)},a.prototype._containerPosition=function(a,b){return null==a&&(a=this.options.state),this.$container.css("margin-left",function(b){return function(){var c;return c=[0,"-"+b._handleWidth+"px"],b.options.indeterminate?"-"+b._handleWidth/2+"px":a?b.options.inverse?c[1]:c[0]:b.options.inverse?c[0]:c[1]}}(this)),b?setTimeout(function(){return b()},50):void 0},a.prototype._init=function(){var a,b;return a=function(a){return function(){return a._width(),a._containerPosition(null,function(){return a.options.animate?a.$wrapper.addClass(""+a.options.baseClass+"-animate"):void 0})}}(this),this.$wrapper.is(":visible")?a():b=c.setInterval(function(d){return function(){return d.$wrapper.is(":visible")?(a(),c.clearInterval(b)):void 0}}(this),50)},a.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":function(a){return function(c,d){var e;return c.preventDefault(),c.stopImmediatePropagation(),e=a.$element.is(":checked"),a._containerPosition(e),e!==a.options.state?(a.options.state=e,a.$wrapper.toggleClass(""+a.options.baseClass+"-off").toggleClass(""+a.options.baseClass+"-on"),d?void 0:(a.$element.is(":radio")&&b("[name='"+a.$element.attr("name")+"']").not(a.$element).prop("checked",!1).trigger("change.bootstrapSwitch",!0),a.$element.trigger("switchChange.bootstrapSwitch",[e]))):void 0}}(this),"focus.bootstrapSwitch":function(a){return function(b){return b.preventDefault(),a.$wrapper.addClass(""+a.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(a){return function(b){return b.preventDefault(),a.$wrapper.removeClass(""+a.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(a){return function(b){if(b.which&&!a.options.disabled&&!a.options.readonly)switch(b.which){case 37:return b.preventDefault(),b.stopImmediatePropagation(),a.state(!1);case 39:return b.preventDefault(),b.stopImmediatePropagation(),a.state(!0)}}}(this)})},a.prototype._handleHandlers=function(){return this.$on.on("click.bootstrapSwitch",function(a){return function(b){return b.preventDefault(),b.stopPropagation(),a.state(!1),a.$element.trigger("focus.bootstrapSwitch")}}(this)),this.$off.on("click.bootstrapSwitch",function(a){return function(b){return b.preventDefault(),b.stopPropagation(),a.state(!0),a.$element.trigger("focus.bootstrapSwitch")}}(this))},a.prototype._labelHandlers=function(){return this.$label.on({"mousedown.bootstrapSwitch touchstart.bootstrapSwitch":function(a){return function(b){return a._dragStart||a.options.disabled||a.options.readonly?void 0:(b.preventDefault(),b.stopPropagation(),a._dragStart=(b.pageX||b.originalEvent.touches[0].pageX)-parseInt(a.$container.css("margin-left"),10),a.options.animate&&a.$wrapper.removeClass(""+a.options.baseClass+"-animate"),a.$element.trigger("focus.bootstrapSwitch"))}}(this),"mousemove.bootstrapSwitch touchmove.bootstrapSwitch":function(a){return function(b){var c;return null==a._dragStart||(b.preventDefault(),c=(b.pageX||b.originalEvent.touches[0].pageX)-a._dragStart,c<-a._handleWidth||c>0)?void 0:(a._dragEnd=c,a.$container.css("margin-left",""+a._dragEnd+"px"))}}(this),"mouseup.bootstrapSwitch touchend.bootstrapSwitch":function(a){return function(b){var c;return a._dragStart?(b.preventDefault(),a.options.animate&&a.$wrapper.addClass(""+a.options.baseClass+"-animate"),a._dragEnd?(c=a._dragEnd>-(a._handleWidth/2),a._dragEnd=!1,a.state(a.options.inverse?!c:c)):a.state(!a.options.state),a._dragStart=!1):void 0}}(this),"mouseleave.bootstrapSwitch":function(a){return function(){return a.$label.trigger("mouseup.bootstrapSwitch")}}(this)})},a.prototype._externalLabelHandler=function(){var a;return a=this.$element.closest("label"),a.on("click",function(b){return function(c){return c.preventDefault(),c.stopImmediatePropagation(),c.target===a[0]?b.toggleState():void 0}}(this))},a.prototype._formHandler=function(){var a;return a=this.$element.closest("form"),a.data("bootstrap-switch")?void 0:a.on("reset.bootstrapSwitch",function(){return c.setTimeout(function(){return a.find("input").filter(function(){return b(this).data("bootstrap-switch")}).each(function(){return b(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",!0)},a.prototype._getClasses=function(a){var c,d,e,f;if(!b.isArray(a))return[""+this.options.baseClass+"-"+a];for(d=[],e=0,f=a.length;f>e;e++)c=a[e],d.push(""+this.options.baseClass+"-"+c);return d},a}(),b.fn.bootstrapSwitch=function(){var c,e,f;return e=arguments[0],c=2<=arguments.length?a.call(arguments,1):[],f=this,this.each(function(){var a,g;return a=b(this),g=a.data("bootstrap-switch"),g||a.data("bootstrap-switch",g=new d(this,e)),"string"==typeof e?f=g[e].apply(g,c):void 0}),f},b.fn.bootstrapSwitch.Constructor=d,b.fn.bootstrapSwitch.defaults={state:!0,size:null,animate:!0,disabled:!1,readonly:!1,indeterminate:!1,inverse:!1,radioAllOff:!1,onColor:"primary",offColor:"default",onText:"ON",offText:"OFF",labelText:"&nbsp;",handleWidth:"auto",labelWidth:"auto",baseClass:"bootstrap-switch",wrapperClass:"wrapper",onInit:function(){},onSwitchChange:function(){}}}(window.jQuery,window)}).call(this);var Charcoal=Charcoal||{};Charcoal.Admin=function(){return arguments.callee.singleton_instance?arguments.callee.singleton_instance:(arguments.callee.singleton_instance=this,this.url="",this.admin_path="",void(this.admin_url=function(){return this.url+this.admin_path+"/"}))},Charcoal.Admin.Property=function(a){window.alert("Property "+a)},Charcoal.Admin.Property.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Property_Audio=function(a){this.property_type="charcoal/admin/property/audio",this.audio_context=null,this.audio_recorder=null,this.animation_frame=null,this.analyser_context=null,this.canvas_width=0,this.canvas_height=0,this.recording_index=0,this.current_recording=null,this.audio_player=null,this.$record_button=$(".btn-record:first"),this.$stop_record_button=$(".btn-stop-record:first"),this.$playback_button=$(".btn-play:first"),this.$reset_button=$(".btn-reset:first"),this.init(a)},Charcoal.Admin.Property_Audio.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Audio.prototype.constructor=Charcoal.Admin.Property_Audio,Charcoal.Admin.Property_Audio.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Audio.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Property_Audio.prototype.default_data=function(){return{obj_type:"",input_id:null}},Charcoal.Admin.Property_Audio.prototype.set_data=function(a){return this.obj_type=a.obj_type,this.input_id=a.input_id,this},Charcoal.Admin.Property_Audio.prototype.init=function(a){var b=$.extend(!0,{},this.default_data(),a);this.set_data(b),this.init_audio()},Charcoal.Admin.Property_Audio.prototype.init_audio=function(){var a=this;window.navigator.getUserMedia||(window.navigator.getUserMedia=window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia),window.navigator.cancelAnimationFrame||(window.navigator.cancelAnimationFrame=window.navigator.webkitCancelAnimationFrame||window.navigator.mozCancelAnimationFrame),window.navigator.requestAnimationFrame||(window.navigator.requestAnimationFrame=window.navigator.webkitRequestAnimationFrame||window.navigator.mozRequestAnimationFrame),window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext),window.navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},optional:[]}},function(b){a.bind_events(),a.got_stream(b)},function(a){window.alert("Error getting audio. Try plugging in a microphone"),window.console.log(a)})},Charcoal.Admin.Property_Audio.prototype.bind_events=function(){var a=this;a.$record_button.on("click",function(){a.manage_recording()}),a.$stop_record_button.on("click",function(){a.manage_recording("stop")}),a.$playback_button.on("click",function(){0!==a.recording_index&&null!==a.audio_player&&a.toggle_playback()}),a.$reset_button.on("click",function(){a.reset_audio()})},Charcoal.Admin.Property_Audio.prototype.got_stream=function(a){var b=this;b.audio_context=new window.AudioContext,b.audio_player=new window.Audio_Player({on_ended:function(){b.manage_button_states("pause_playback")}});var c=b.audio_context.createGain(),d=b.audio_context.createMediaStreamSource(a),e=null;d.connect(c),window.analyserNode=b.audio_context.createAnalyser(),window.analyserNode.fftSize=2048,c.connect(window.analyserNode),b.audio_recorder=new window.Recorder(c),e=b.audio_context.createGain(),e.gain.value=0,c.connect(e),e.connect(b.audio_context.destination),b.update_analysers()},Charcoal.Admin.Property_Audio.prototype.manage_button_states=function(a){switch(a){case"start_recording":this.$record_button.text(this.$record_button.attr("data-label-pause")),this.$record_button.addClass("-is-recording"),this.$stop_record_button.prop("disabled",!1),this.$playback_button.prop("disabled",!0),this.$reset_button.prop("disabled",!1);break;case"pause_recording":this.$record_button.text(this.$record_button.attr("data-label-record")),this.$record_button.removeClass("-is-recording"),this.$stop_record_button.prop("disabled",!1),this.$playback_button.prop("disabled",!0),this.$reset_button.prop("disabled",!1);break;case"stop_recording":this.$record_button.text(this.$record_button.attr("data-label-record")),this.$record_button.removeClass("-is-recording"),this.$stop_record_button.prop("disabled",!0),this.$playback_button.prop("disabled",!1),this.$reset_button.prop("disabled",!1);break;case"start_playback":this.$playback_button.text(this.$playback_button.attr("data-label-pause")),this.$playback_button.addClass("-is-playing");break;case"pause_playback":this.$playback_button.text(this.$playback_button.attr("data-label-play")),this.$playback_button.removeClass("-is-playing");break;case"reset":this.$record_button.text(this.$record_button.attr("data-label-record")),this.$record_button.removeClass("-is-recording"),this.$stop_record_button.prop("disabled",!0),this.$playback_button.prop("disabled",!0),this.$playback_button.text(this.$playback_button.attr("data-label-play")),this.$playback_button.removeClass("-is-playing"),this.$reset_button.prop("disabled",!0)}},Charcoal.Admin.Property_Audio.prototype.manage_recording=function(a){var b=this;if("stop"===a)return b.audio_recorder.stop(),b.audio_recorder.get_buffers(function(a){b.got_buffers(a),b.audio_recorder.clear()}),void b.manage_button_states("stop_recording");if(b.audio_recorder.is_recording())b.audio_recorder.stop(),b.manage_button_states("pause_recording");else{if(!b.audio_recorder)return;b.audio_recorder.record(),b.manage_button_states("start_recording")}},Charcoal.Admin.Property_Audio.prototype.toggle_playback=function(){if(this.audio_player.is_playing())this.audio_player.pause(),this.manage_button_states("pause_playback");else{if(!this.audio_player)return;this.audio_player.play(),this.manage_button_states("start_playback")}},Charcoal.Admin.Property_Audio.prototype.reset_audio=function(){var a=window.document.getElementById("analyser"),b=a.getContext("2d");b.clearRect(0,0,a.canvas_width,a.canvas_height);var c=window.document.getElementById("wavedisplay"),d=c.getContext("2d");d.clearRect(0,0,c.canvas_width,c.canvas_height),this.audio_player.load(),this.audio_player.src(""),this.audio_recorder.stop(),this.audio_recorder.clear(),this.manage_button_states("reset")},Charcoal.Admin.Property_Audio.prototype.got_buffers=function(a){var b=window.document.getElementById("wavedisplay"),c=this;c.draw_buffer(b.width,b.height,b.getContext("2d"),a[0]),c.audio_recorder.export_wav(function(a){c.done_encoding(a)})},Charcoal.Admin.Property_Audio.prototype.draw_buffer=function(a,b,c,d){var e=Math.ceil(d.length/a),f=b/2;c.fillStyle="silver",c.clearRect(0,0,a,b);for(var g=0;a>g;g++){for(var h=1,i=-1,j=0;e>j;j++){var k=d[g*e+j];h>k&&(h=k),k>i&&(i=k)}c.fillRect(g,(1+h)*f,1,Math.max(1,(i-h)*f))}},Charcoal.Admin.Property_Audio.prototype.done_encoding=function(a){var b=new window.FileReader,c=null,d=this;b.readAsDataURL(a),b.onloadend=function(){c=b.result,d.recording_index++,d.manage_audio_data(c)}},Charcoal.Admin.Property_Audio.prototype.manage_audio_data=function(a){if(a){var b=window.document.getElementById(this.input_id);b&&(b.value=a),this.audio_player.src(a),this.audio_player.load(),this.$playback_button.removeClass("-is-hidden")}},Charcoal.Admin.Property_Audio.prototype.cancel_analyser_update=function(){window.cancelAnimationFrame(this.animation_frame),this.animation_frame=null},Charcoal.Admin.Property_Audio.prototype.update_analysers=function(){var a=this;if(!a.analyserContext){var b=window.document.getElementById("analyser");a.canvas_width=b.width,a.canvas_height=b.height,a.analyserContext=b.getContext("2d")}var c=3,d=1,e=Math.round(a.canvas_width/c),f=new window.Uint8Array(window.analyserNode.frequencyBinCount),g=0;window.analyserNode.getByteFrequencyData(f),g=window.analyserNode.frequencyBinCount/e,a.analyserContext.clearRect(0,0,a.canvas_width,a.canvas_height),a.analyserContext.fillStyle="#F6D565",a.analyserContext.lineCap="round";for(var h=0;e>h;++h){for(var i=0,j=Math.floor(h*g),k=0;g>k;k++)i+=f[j+k];i/=g,a.analyserContext.fillStyle="hsl( "+Math.round(360*h/e)+", 100%, 50%)",a.analyserContext.fillRect(h*c,a.canvas_height,d,-i)}a.animation_frame=window.requestAnimationFrame(function(){a.update_analysers()})},function(a){var b="../../assets/admin/scripts/vendors/recorderWorker.js",c=function(c,d){var e,f=d||{},g=f.buffer_length||4096,h=new a.Worker(f.workerPath||b),i=!1;this.context=c.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(g,2,2):this.node=this.context.createJavaScriptNode(g,2,2),h.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}}),this.node.onaudioprocess=function(a){i&&h.postMessage({command:"record",buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){h.postMessage({command:"clear"})},this.get_buffers=function(a){e=a||f.callback,h.postMessage({command:"getBuffers"})},this.export_wav=function(a,b){if(e=a||f.callback,b=b||f.type||"audio/wav",!e)throw new Error("Callback not set");h.postMessage({command:"exportWAV",type:b})},this.is_recording=function(){return i},h.onmessage=function(a){var b=a.data;e(b)},c.connect(this.node),this.node.connect(this.context.destination)};a.Recorder=c}(window),function(a){var b=function(b){this.callbacks={on_ended:b.on_ended||function(){},on_pause:b.on_pause||function(){},on_playing:b.on_playing||function(){},on_timeupdate:b.on_timeupdate||function(){}},this.element=new a.Audio,this.play=function(){this.element.play()},this.pause=function(){this.element.pause()},this.load=function(){this.element.load()},this.src=function(a){this.element.src=a},this.is_playing=function(){return!this.element.paused&&!this.element.ended&&this.element.currentTime>0};var c=this;c.element.addEventListener("ended",function(){c.callbacks.on_ended()}),c.element.addEventListener("pause",function(){c.callbacks.on_pause()}),c.element.addEventListener("playing",function(){c.callbacks.on_playing()}),c.element.addEventListener("timeupdate",function(){c.callbacks.on_timeupdate()})};a.Audio_Player=b}(window),Charcoal.Admin.Property_Input_Tinymce=function(a){this.input_type="charcoal/admin/property/input/tinymce",this.input_id=null,this.editor_options=null,this.init(a)},Charcoal.Admin.Property_Input_Tinymce.prototype.init=function(a){this.input_id=a.input_id||null,this.editor_options=a.editor_options||{};var b={plugins:["advlist","anchor","autolink","autoresize","charmap","code","colorpicker","contextmenu","fullscreen","hr","image","link","lists","media","nonbreaking","noneditable","paste","print","searchreplace","tabfocus","table","visualblocks","visualchars","wordcount"],toolbar:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image anchor",browser_spellcheck:!0,end_container_on_empty_block:!0,allow_conditional_comments:!0,convert_fonts_to_spans:!0,forced_root_block:"p",allow_script_urls:!1,document_base_url:"{{base_url}}",relative_urls:!0,remove_script_host:!1,autoresize_min_height:"150px",autoresize_max_height:"400px",contextmenu:"link image inserttable | cell row column deletetable",image_advtab:!0,importcss_append:!0,media_alt_source:!1,media_poster:!0,media_dimensions:!0,nonbreaking_force_tab:!1,paste_data_images:!0,paste_as_text:!0,paste_merge_formats:!0,table_grid:!0,table_tab_navigation:!0,visualblocks_default_state:!1},c=$.extend({},b,this.editor_options);c.selector="#"+this.input_id,tinymce.init(c)},Charcoal.Admin.Template=function(a){window.alert("Template "+a)},Charcoal.Admin.Template.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Template_Login=function(a){this.template_type="charcoal/admin/template/login",this.init(a)},Charcoal.Admin.Template_Login.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Login.prototype.constructor=Charcoal.Admin.Template_Login,Charcoal.Admin.Template_Login.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Login.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Template_Login.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Login.prototype.bind_events=function(){var a=this;$(".login-submit").on("click",function(b){b.preventDefault();var c=$(this).parents("form"),d=a.admin.admin_url()+"action/json/login",e=c.serialize();$.post(d,e,function(a){window.console.debug(a),a.success?window.location.href=a.next_url:window.alert("Error")}).fail(function(){window.alert("Error")})})},Charcoal.Admin.Template_MenuHeader=function(){$(".js-toggle-class").click(function(a){a.preventDefault();var b=$(this),c=b.data("class"),d=b.data("target");$(d).toggleClass(c)}),$(document).on("click",".js-accordion-header",function(a){a.preventDefault();var b=$(this);b.toggleClass("is-open").siblings(".js-accordion-content").stop().slideToggle()})},Charcoal.Admin.Widget=function(a){window.alert("Widget "+a)},Charcoal.Admin.Widget.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Widget.prototype.reload=function(a){var b=this,c=b.admin.admin_url()+"action/json/widget/load",d={widget_type:b.widget_type,widget_options:b.widget_options()};$.post(c,d,a)},Charcoal.Admin.Widget_Form=function(a){this.widget_type="charcoal/admin/widget/form",this.obj_type=null,this.obj_id=null,this.init(a)},Charcoal.Admin.Widget_Form.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Form.prototype.constructor=Charcoal.Admin.Widget_Form,Charcoal.Admin.Widget_Form.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Form.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Widget_Form.prototype.init=function(a){var b=$.extend(!0,{},a);this.set_data(b),this.bind_events()},Charcoal.Admin.Widget_Form.prototype.set_data=function(a){return this.obj_type=a.obj_type||null,this.obj_id=a.obj_id||null,this},Charcoal.Admin.Widget_Form.prototype.bind_events=function(){var a=this;$(".form-submit").on("click",function(b){b.preventDefault();var c;c=a.obj_id?a.admin.admin_url()+"action/json/object/update":a.admin.admin_url()+"action/json/object/save";var d=$(this).parents("form"),e=new FormData(d[0]);e.append("obj_type",a.obj_type),e.append("obj_id",a.obj_id),$.ajax({url:c,type:"POST",processData:!1,contentType:!1,data:e,success:function(a){window.console.debug(a),a.success?window.alert("Save successful!"):window.alert("Error. Could not save object.")},error:function(){window.alert("Error attempting to save form.")}})})},Charcoal.Admin.Widget_Table=function(a){this.widget_type="charcoal/admin/widget/table",this.obj_type=null,this.widget_id=null,this.properties=null,this.properties_options=null,this.filters=null,this.orders=null,this.pagination=null,this.filters=null,this.init(a)},Charcoal.Admin.Widget_Table.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Table.prototype.constructor=Charcoal.Admin.Widget_Table,Charcoal.Admin.Widget_Table.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Table.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Widget_Table.prototype.init=function(a){var b=$.extend(!0,{},this.default_data(),a);this.set_data(b),this.bind_events()},Charcoal.Admin.Widget_Table.prototype.default_data=function(){return{obj_type:"",widget_id:null,properties:null,properties_options:null,filters:null,orders:null,pagination:{page:1,num_per_page:50}}},Charcoal.Admin.Widget_Table.prototype.set_data=function(a){return this.obj_type=a.obj_type||"",this.widget_id=a.widget_id||null,this},Charcoal.Admin.Widget_Table.prototype.bind_events=function(){this.bind_obj_events(),this.bind_list_events(),this.bind_sublist_events()},Charcoal.Admin.Widget_Table.prototype.bind_obj_events=function(){var a=this;$(".obj-edit").on("click",function(a){a.preventDefault();var b=$(this).parents("tr").data("id");window.alert("Edit "+b)}),$(".obj-quick-edit").on("click",function(b){b.preventDefault();var c=$(this).parents("tr").data("id"),d=a.admin.admin_url()+"action/json/widget/load",e={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:a.obj_type,obj_id:c}};$.post(d,e,function(a){var b=BootstrapDialog.show({title:"Quick Edit",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})}),$(".obj-inline-edit").on("click",function(b){b.preventDefault();var c=$(this).parents("tr"),d=c.data("id"),e=a.admin.admin_url()+"action/json/widget/table/inline",f={obj_type:a.obj_type,obj_id:d};$.post(e,f,function(a){if(a.success){var b,d=a.inline_properties;for(b in d){var e=c.find(".property-"+b);e.html(d[b])}}})}),$(".obj-delete").on("click",function(b){b.preventDefault();var c=$(this).parents("tr").data("id");if(window.confirm("Are you sure you want to delete this object?")){var d=a.admin.admin_url()+"action/json/object/delete",e={obj_type:a.obj_type,obj_id:c};$.post(d,e,function(b){b.success?a.reload():window.alert("Delete failed.")})}})},Charcoal.Admin.Widget_Table.prototype.bind_list_events=function(){var a=this;$(".list-quick-create").on("click",function(b){b.preventDefault();var c=a.admin.admin_url()+"action/json/widget/load",d={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:a.obj_type,obj_id:0}};$.post(c,d,function(a){var b=BootstrapDialog.show({title:"Quick Create",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})})},Charcoal.Admin.Widget_Table.prototype.bind_sublist_events=function(){var a=this;$(".sublist-inline-edit").on("click",function(b){b.preventDefault();var c=a.sublist(),d=a.admin.admin_url()+"action/json/widget/table/inlinemulti",e={obj_type:a.obj_type,obj_ids:c.obj_ids};$.post(d,e,function(a){if(a.success)for(var b=a.objects,d=0;d<=b.length-1;d++){window.console.debug(b[d]);var e=b[d].inline_properties,f=$(c.elems[d]).parents("tr"),g=0;for(g in e){var h=f.find(".property-"+g);
h.html(e[g])}}})})},Charcoal.Admin.Widget_Table.prototype.sublist=function(){var a=$(".select-row:checked"),b={elems:[],obj_ids:[]};return a.each(function(a,c){b.obj_ids.push($(c).parents("tr").data("id")),b.elems.push(c)}),b},Charcoal.Admin.Widget_Table.prototype.widget_options=function(){return{obj_type:this.obj_type,properties:this.properties,properties_options:this.properties_options,filters:this.filters,orders:this.orders,pagination:this.pagination}},Charcoal.Admin.Widget_Table.prototype.reload=function(){var a=this,b=a.admin.admin_url()+"action/json/widget/load",c={widget_type:a.widget_type,widget_options:a.widget_options()};$.post(b,c,function(b){b.success&&b.widget_html&&($("#"+a.widget_id).replaceWith(b.widget_html),a.widget_id=b.widget_id,a.bind_events())})};