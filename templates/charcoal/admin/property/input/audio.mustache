{{!--
Audio Property Input
=======================

`charcoal/admin/property/input/audio`

--}}

<div class="o-toolbox -small -left" id="{{input_id}}">
    <div class="o-toolbox_actions">
        <div class="btn-group-vertical">
            <label for="voice_message_input_{{input_id}}" class="btn btn-default js-toggle-pane" data-pane="text"><svg class="o-toolbox_icon" role="img" title="Enter text"><use xlink:href="{{base_url}}assets/admin/images/svgs.svg#icon-text"></use></svg></label>
            <button type="button" class="btn btn-default js-toggle-pane" data-pane="recording"><svg class="o-toolbox_icon" role="img" title="Enregistrer un message"><use xlink:href="{{base_url}}assets/admin/images/svgs.svg#icon-microphone"></use></svg></button>
            <button type="button" class="btn btn-default js-toggle-pane" data-pane="file"><svg class="o-toolbox_icon" role="img" title="Use an audio file"><use xlink:href="{{base_url}}assets/admin/images/svgs.svg#icon-file"></use></svg></button>
        </div>
    </div>
    <div class="o-toolbox_content">
        <div class="o-toolbox_pane js-pane hidden" data-pane="text">
            <textarea id="voice_message_input_{{input_id}}" class="form-control -norounded -noborder js-text-voice-message" name="voice_message" style="height:100%;" name="voice_message[fr]">{{&alert.voice_message.fr}}</textarea>
        </div>
        <div class="o-toolbox_pane js-pane hidden" data-pane="recording">
            {{!-- Here be the recording widget --}}
            <div class="c-audio-player -complex">
                <div class="c-audio-player_wrap">

                    <button class="btn c-audio-player_button -playback js-recording-playback" disabled type="button" title="Toggle playback">
                        <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
                        <span class="glyphicon glyphicon-pause" aria-hidden="true"></span>
                    </button>
                    <button class="btn c-audio-player_button -stop js-recording-stop" disabled type="button" title="Complete recording">
                        <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
                    </button>
                    <button class="btn c-audio-player_button -reset js-recording-reset" disabled type="button" title="Restart recording">
                        <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                    </button>

                    <button class="btn c-audio-player_button -record js-recording-record" type="button">
                        <span class="c-audio-player_button_circle"></span>
                        <span class="glyphicon glyphicon-pause" aria-hidden="true"></span>
                    </button>

                    <span class="c-audio-player_time js-recording-timer">00:00</span>
                </div>
                <canvas class="c-audio-player_canvas -analyser js-recording-analyser"></canvas>
                <canvas class="c-audio-player_canvas -waves hidden js-recording-waves"></canvas>
            </div>
        </div>
        <div class="o-toolbox_pane js-pane hidden" data-pane="file">
            {{#alert.voice_audio}}
            <audio src="/{{alert.voice_audio}}" controls>
            {{/alert.voice_audio}}
            {{^alert.voice_audio}}
            <input type="file" name="voice_audio" class="form-control">
            {{/alert.voice_audio}}

        </div>
    </div>
    {{!
        Input that will contain the actual data
        This input will be posted on save / update
    }}
    <input
        id="hidden_{{input_id}}"
        type="hidden"
        name="voice_audio"
        value="{{input_val}}">
</div>


{{#add_js}}
<script>
Charcoal.Admin.manager().add_property_input({
    id: '{{input_id}}',
    type: 'charcoal/admin/property/input/audio',
    data: {
        active_pane: 'text',
        hidden_input_id: 'hidden_{{input_id}}'
    }
});
</script>
{{/add_js}}
