{{!--
Tinymce Property Input
======================

`charcoal/admin/property/input/tinymce`

--}}

<textarea
        id="{{inputId}}"
        name="{{inputName}}"
        class="form-control {{inputClass}}"
        cols="{{cols}}"
        rows="{{rows}}"
    {{#readOnly}}readonly{{/readOnly}}
    {{#required}}required{{/required}}
    {{#disabled}}disabled{{/disabled}}
>{{&inputVal}}</textarea>

{{#addJs}}
    <script>
        // "You can't use document.write once the document has completed loading. If you do, the browser will open a new document that replaces the current."
        // http://stackoverflow.com/questions/2360076/javascript-document-write-replaces-all-body-content-when-using-ajax
        var _testTinymce = window.tinyMCE || false;


        if (!_testTinymce) {
            if (document.readyState !== 'complete') {
                document.write('<script src="{{baseUrl}}assets/admin/scripts/vendors/tinymce/tinymce.min.js"><\/script>')
            } else {
                var _script = document.createElement('script');
                _script.src = '{{baseUrl}}assets/admin/scripts/vendors/tinymce/tinymce.min.js';
                document.querySelector('head').appendChild(_script);
            }
        }
    </script>

    <script>

        var elFinderCallback = window.elFinderCallback || {};

        elFinderCallback['{{inputId}}'] = function (file, elf) {
            // pass selected file data to TinyMCE
            parent.tinyMCE.activeEditor.windowManager.getParams().oninsert(file, elf);
            // close popup window
            parent.tinyMCE.activeEditor.windowManager.close();
        };

        Charcoal.Admin.manager().add_property_input({
            id      : '{{inputId}}',
            input_id: '{{inputId}}',
            type    : 'charcoal/admin/property/input/tinymce',
            data    : {
                editor_options: {{&editorOptionsJson}},
                dialog_title  : '{{ dialogTitle }}',
                elfinder_url  : '{{ admin_url }}elfinder?obj_type={{ objType }}&obj_id={{ objId }}&property={{ p.ident }}&callback={{ inputId }}'
            }
        });
    </script>
{{/addJs}}
