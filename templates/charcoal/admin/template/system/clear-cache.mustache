{{!--
`charcoal/admin/template/system/users`
--}}
{{>charcoal/admin/template/inc.header}}

<div class="o-flex">
    {{#showSidemenu}}
        {{#sidemenu}}
            {{>charcoal/admin/widget/sidemenu}}
        {{/sidemenu}}
    {{/showSidemenu}}

    {{>charcoal/admin/widget/feedbacks}}

    {{!-- Object list section --}}
    <div class="o-flex_main">
        <div class="o-container -top -bottom clearfix">
            <header class="o-container_header">
                {{# title }}<h2>{{&.}}</h2>{{/ title }}
                {{# subtitle }}<h3>{{&.}}</h3>{{/ subtitle }}
            </header>

            <div class="dashboard">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-lg-4">
                        <section class="panel panel-default">
                            <header class="panel-heading">
                                <h3 class="panel-title">{{#_t}}Global cache{{/_t}}</h3>
                            </header>
                            <div class="panel-body">
                                <p>{{#_t}}Clearing this cache will clear *all* entries in the cache. In other words, it completely erase all items in the cache (pages, objects and everything else).{{/_t}}</p>
                                <p>
                                    <dl>
                                        <dt>Type</dt>
                                        <dd>{{cacheInfo.type}}</dd>
                                        <dt>{{#_t}}Num entries{{/_t}}</dt>
                                        <dd>{{cacheInfo.global.num_entries}}</dd>
                                        <dt>{{#_t}}Total size{{/_t}}</dt>
                                        <dd>{{cacheInfo.global.total_size}}
                                        <dd></dd>
                                    </dl>
                                <p>
                                <p><a class="btn btn-info js-clear-cache" data-type="global">{{#_t}}Clear global cache{{/_t}}</a></p>
                            </div>
                        </section>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-lg-4">
                        <section class="panel panel-default">
                            <header class="panel-heading">
                                <h3 class="panel-title">{{#_t}}Pages cache{{/_t}}</h3>
                            </header>
                            <div class="panel-body">
                                <p>{{#_t}}Some pages might be saved entirely in the cache, either at route-level or template-level. Clearing this cache will make sure the pages will be rebuilt at next request.{{/_t}}</p>
                                <p>
                                    <dl>
                                        <dt>{{#_t}}Num entries{{/_t}}</dt>
                                        <dd>{{cacheInfo.pages.num_entries}}</dd>
                                        <dt>{{#_t}}Total size{{/_t}}</dt>
                                        <dd>{{cacheInfo.pages.total_size}}
                                        <dd></dd>
                                    </dl>
                                <p>
                                <p><a class="btn btn-info js-clear-cache" data-type="pages">{{#_t}}Clear pages cache{{/_t}}</a></p>
                            </div>
                        </section>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-lg-4">
                        <section class="panel panel-default">
                            <header class="panel-heading">
                                <h3 class="panel-title">{{#_t}}Objects cache{{/_t}}</h3>
                            </header>
                            <div class="panel-body">
                                <p>{{#_t}}This cache includes the objects and their metadata. Clearing this cache will reset all metadata from their JSON files and objects will be reloaded from their source (database) at next request.{{/_t}}</p>
                                <p>
                                    <dl>
                                        <dt>{{#_t}}Num entries{{/_t}}</dt>
                                        <dd>{{cacheInfo.objects.num_entries}}</dd>
                                        <dt>{{#_t}}Total size{{/_t}}</dt>
                                        <dd>{{cacheInfo.objects.total_size}}
                                        <dd></dd>
                                    </dl>
                                <p>
                                <p><a class="btn btn-info js-clear-cache" data-type="objects">{{#_t}}Clear objects cache{{/_t}}</a></p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{#addJs}}
<script>
$('.js-clear-cache').on('click', function() {
    var url = Charcoal.Admin.admin_url() + 'system/clear-cache';
    var data = {
        cache_type: $(this).data('type')
    };
    $.post(url, data, function (response) {
        window.console.debug(response);

        var feedback = response.feedbacks.shift();
        if (response.success) {
            BootstrapDialog.show({
                title:   'Cache cleared',
                message: feedback.message,
                type:    BootstrapDialog.TYPE_SUCCESS
            });
        } else {
            BootstrapDialog.show({
                title:   'Error clearing cache',
                message: feedback.message,
                type:    BootstrapDialog.TYPE_DANGER
            });
        }
    }, 'json');
});
</script>
{{/addJs}}

{{>charcoal/admin/template/inc.footer}}
