/*! charcoal-admin 17-06-2015 */
var Charcoal=Charcoal||{};Charcoal.Admin=function(){return arguments.callee._singleton_instance?arguments.callee._singleton_instance:(arguments.callee._singleton_instance=this,this.url="",this.admin_path="",void(this.admin_url=function(){return this.url+this.admin_path+"/"}))},Charcoal.Admin.Template=function(a){window.alert("Template "+a)},Charcoal.Admin.Template.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Template_Login=function(a){this.template_type="charcoal/admin/template/login",this.init(a)},Charcoal.Admin.Template_Login.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Login.prototype.constructor=Charcoal.Admin.Template_Login,Charcoal.Admin.Template_Login.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Login.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Template_Login.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Login.prototype.bind_events=function(){var a=this;$(".login-submit").on("click",function(b){b.preventDefault();var c=$(this).parents("form"),d=a.admin.admin_url()+"action/json/login",e=c.serialize();$.post(d,e,function(a){window.console.debug(a),a.success?window.location.href=a.next_url:window.alert("Error")}).fail(function(){window.alert("Error")})})},Charcoal.Admin.Widget=function(a){window.alert("Widget "+a)},Charcoal.Admin.Widget.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Widget.prototype.reload=function(a){var b=this,c=b.admin.admin_url()+"action/json/widget/load",d={widget_type:b.widget_type,widget_options:b.widget_options()};$.post(c,d,a)},Charcoal.Admin.Widget_Table=function(a){this.widget_type="charcoal/admin/widget/table",this.obj_type=null,this.widget_id=null,this.properties=null,this.properties_options=null,this.filters=null,this.orders=null,this.pagination=null,this.filters=null,this.init(a)},Charcoal.Admin.Widget_Table.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Table.prototype.constructor=Charcoal.Admin.Widget_Table,Charcoal.Admin.Widget_Table.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Table.prototype.admin=new Charcoal.Admin,Charcoal.Admin.Widget_Table.prototype.init=function(a){var b=$.extend(!0,{},this.default_data(),a);this.set_data(b),this.bind_events()},Charcoal.Admin.Widget_Table.prototype.default_data=function(){return{obj_type:"",widget_id:null,properties:null,properties_options:null,filters:null,orders:null,pagination:{page:1,num_per_page:50}}},Charcoal.Admin.Widget_Table.prototype.set_data=function(a){return this.obj_type=a.obj_type||"",this.widget_id=a.widget_id||null,this},Charcoal.Admin.Widget_Table.prototype.bind_events=function(){this.bind_obj_events(),this.bind_list_events(),this.bind_sublist_events()},Charcoal.Admin.Widget_Table.prototype.bind_obj_events=function(){var a=this;$(".obj-edit").on("click",function(a){a.preventDefault();var b=$(this).parents("tr").data("id");window.alert("Edit "+b)}),$(".obj-quick-edit").on("click",function(b){b.preventDefault();var c=$(this).parents("tr").data("id"),d=a.admin.admin_url()+"action/json/widget/load",e={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:a.obj_type,obj_id:c}};$.post(d,e,function(a){var b=BootstrapDialog.show({title:"Quick Edit",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})}),$(".obj-inline-edit").on("click",function(b){b.preventDefault();var c=$(this).parents("tr"),d=c.data("id"),e=a.admin.admin_url()+"action/json/widget/table/inline",f={obj_type:a.obj_type,obj_id:d};$.post(e,f,function(a){if(a.success){var b,d=a.inline_properties;for(b in d){var e=c.find(".property-"+b);e.html(d[b])}}})}),$(".obj-delete").on("click",function(b){b.preventDefault();var c=$(this).parents("tr").data("id");if(window.confirm("Are you sure you want to delete this object?")){var d=a.admin.admin_url()+"action/json/object/delete",e={obj_type:a.obj_type,obj_id:c};$.post(d,e,function(b){b.success?a.reload():window.alert("Delete failed.")})}})},Charcoal.Admin.Widget_Table.prototype.bind_list_events=function(){var a=this;$(".list-quick-create").on("click",function(b){b.preventDefault();var c=a.admin.admin_url()+"action/json/widget/load",d={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:a.obj_type,obj_id:0}};$.post(c,d,function(a){var b=BootstrapDialog.show({title:"Quick Create",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})})},Charcoal.Admin.Widget_Table.prototype.bind_sublist_events=function(){var a=this;$(".sublist-inline-edit").on("click",function(b){b.preventDefault();var c=a.sublist(),d=a.admin.admin_url()+"action/json/widget/table/inlinemulti",e={obj_type:a.obj_type,obj_ids:c.obj_ids};$.post(d,e,function(a){if(a.success)for(var b=a.objects,d=0;d<=b.length-1;d++){window.console.debug(b[d]);var e=b[d].inline_properties,f=$(c.elems[d]).parents("tr"),g=0;for(g in e){var h=f.find(".property-"+g);h.html(e[g])}}})})},Charcoal.Admin.Widget_Table.prototype.sublist=function(){var a=$(".select-row:checked"),b={elems:[],obj_ids:[]};return a.each(function(a,c){b.obj_ids.push($(c).parents("tr").data("id")),b.elems.push(c)}),b},Charcoal.Admin.Widget_Table.prototype.widget_options=function(){return{obj_type:this.obj_type,properties:this.properties,properties_options:this.properties_options,filters:this.filters,orders:this.orders,pagination:this.pagination}},Charcoal.Admin.Widget_Table.prototype.reload=function(){var a=this,b=a.admin.admin_url()+"action/json/widget/load",c={widget_type:a.widget_type,widget_options:a.widget_options()};$.post(b,c,function(b){b.success&&b.widget_html&&($("#"+a.widget_id).replaceWith(b.widget_html),a.widget_id=b.widget_id,a.bind_events())})};